<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>좋아요 버튼</title>
</head>
<body>
    <h1>좋아요 버튼</h1>
    <button id="likeButton" onclick="like()">좋아요</button>
    <p id="likeCount">좋아요 개수: <span id="count">0</span></p>

    <script>
        // 좋아요 버튼 클릭 시 호출되는 함수
        function like() {
            // GitHub 저장소의 like.json 파일을 업데이트
            fetch('https://api.github.com/repos/your-username/your-repo/contents/like.json')
                .then(response => response.json())
                .then(data => {
                    // 현재 좋아요 개수 가져오기
                    const currentCount = data.content ? JSON.parse(atob(data.content)).count : 0;

                    // 좋아요 개수 증가
                    const newCount = currentCount + 1;

                    // 좋아요 개수 업데이트
                    const content = { count: newCount };
                    const encodedContent = btoa(JSON.stringify(content));

                    // GitHub API를 사용하여 like.json 파일 업데이트
                    fetch('https://api.github.com/repos/Hungbok/hungbok.net/contents/data/test/like.json', {
                        method: 'PUT',
                        headers: {
                            'Authorization': 'Bearer GHSAT0AAAAAACLY4V3VITHHKGWXIOB2JWPGZMLQBEA',
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Update like count',
                            content: encodedContent,
                            sha: data.sha,
                        }),
                    })
                        .then(response => response.json())
                        .then(() => {
                            // 화면에 좋아요 개수 업데이트
                            document.getElementById('count').innerText = newCount;
                        })
                        .catch(error => console.error('Error updating like count:', error));
                })
                .catch(error => console.error('Error fetching like.json:', error));
        }

        // 초기 좋아요 개수 표시
        fetch('https://raw.githubusercontent.com/Hungbok/hungbok.net/main/data/test/like.json')
            .then(response => response.json())
            .then(data => {
                const initialCount = data.content ? JSON.parse(atob(data.content)).count : 0;
                document.getElementById('count').innerText = initialCount;
            })
            .catch(error => console.error('Error fetching initial like count:', error));
    </script>
</body>
</html>
